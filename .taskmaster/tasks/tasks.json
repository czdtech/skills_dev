{
  "master": {
    "tasks": [
      {
        "id": 6,
        "title": "项目初始化与技术栈搭建",
        "description": "搭建 TypeScript + React 前端和 Node.js + Express 后端的基础项目结构，配置 PostgreSQL 数据库连接",
        "details": "1. 初始化前端项目：npx create-react-app client --template typescript\n2. 初始化后端项目：mkdir server && cd server && npm init -y\n3. 安装核心依赖：\n   - 后端：express, pg, dotenv, cors, typescript, @types/node, @types/express\n   - 前端：axios, react-router-dom\n4. 配置 tsconfig.json（前后端）\n5. 创建基础目录结构：\n   - server/src/{routes,controllers,models,middleware,config}\n   - client/src/{components,pages,services,types}\n6. 配置 PostgreSQL 连接池：\n```typescript\n// server/src/config/database.ts\nimport { Pool } from 'pg';\nexport const pool = new Pool({\n  host: process.env.DB_HOST,\n  port: Number(process.env.DB_PORT),\n  database: process.env.DB_NAME,\n  user: process.env.DB_USER,\n  password: process.env.DB_PASSWORD\n});\n```\n7. 创建 .env.example 文件模板\n8. 配置 CORS 和基础中间件",
        "testStrategy": "1. 验证前后端项目可正常启动（npm start）\n2. 测试数据库连接：编写简单查询验证连接成功\n3. 测试前后端通信：创建 /api/health 端点，前端调用验证\n4. 检查 TypeScript 编译无错误",
        "priority": "high",
        "dependencies": [],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 7,
        "title": "数据库模型设计与迁移脚本",
        "description": "设计任务管理系统的数据库表结构，包括任务、用户、依赖关系等核心表，并创建迁移脚本",
        "details": "1. 设计核心表结构：\n```sql\n-- users 表\nCREATE TABLE users (\n  id SERIAL PRIMARY KEY,\n  username VARCHAR(50) UNIQUE NOT NULL,\n  email VARCHAR(100) UNIQUE NOT NULL,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n\n-- tasks 表\nCREATE TABLE tasks (\n  id SERIAL PRIMARY KEY,\n  title VARCHAR(200) NOT NULL,\n  description TEXT,\n  status VARCHAR(20) DEFAULT 'pending',\n  priority VARCHAR(10) DEFAULT 'medium',\n  complexity_score INT,\n  assigned_to INT REFERENCES users(id),\n  created_by INT REFERENCES users(id),\n  created_at TIMESTAMP DEFAULT NOW(),\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n\n-- task_dependencies 表\nCREATE TABLE task_dependencies (\n  id SERIAL PRIMARY KEY,\n  task_id INT REFERENCES tasks(id) ON DELETE CASCADE,\n  depends_on_task_id INT REFERENCES tasks(id) ON DELETE CASCADE,\n  UNIQUE(task_id, depends_on_task_id)\n);\n\n-- comments 表\nCREATE TABLE comments (\n  id SERIAL PRIMARY KEY,\n  task_id INT REFERENCES tasks(id) ON DELETE CASCADE,\n  user_id INT REFERENCES users(id),\n  content TEXT NOT NULL,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n```\n2. 创建迁移脚本管理工具（使用 node-pg-migrate 或手动脚本）\n3. 创建索引优化查询性能",
        "testStrategy": "1. 运行迁移脚本验证表创建成功\n2. 测试外键约束：尝试插入无效引用数据应失败\n3. 验证索引存在：EXPLAIN ANALYZE 查询计划\n4. 插入测试数据验证表关系正确",
        "priority": "high",
        "dependencies": [
          6
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 8,
        "title": "OpenAI API 集成与任务智能分解功能",
        "description": "集成 OpenAI API，实现将大型任务自动分解为小任务、分析依赖关系和评估复杂度的核心AI功能",
        "details": "1. 安装 openai SDK：npm install openai\n2. 创建 AI 服务模块：\n```typescript\n// server/src/services/aiService.ts\nimport OpenAI from 'openai';\n\nconst openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });\n\nexport async function decomposeTask(taskDescription: string) {\n  const prompt = `分析以下任务并分解为3-5个可执行的子任务，识别依赖关系，评估复杂度(1-10)：\\n${taskDescription}\\n\\n返回JSON格式：{\"subtasks\": [{\"title\": \"\", \"description\": \"\", \"complexity\": 0, \"dependencies\": []}]}`;\n  \n  const response = await openai.chat.completions.create({\n    model: 'gpt-4',\n    messages: [{ role: 'user', content: prompt }],\n    temperature: 0.7\n  });\n  \n  return JSON.parse(response.choices[0].message.content);\n}\n```\n3. 创建任务分解 API 端点：\n```typescript\n// POST /api/tasks/decompose\nrouter.post('/decompose', async (req, res) => {\n  const { description } = req.body;\n  const result = await aiService.decomposeTask(description);\n  res.json(result);\n});\n```\n4. 实现错误处理和重试机制\n5. 添加 API 调用限流保护",
        "testStrategy": "1. 单元测试：mock OpenAI 响应验证解析逻辑\n2. 集成测试：使用真实 API 测试任务分解（小批量）\n3. 验证返回 JSON 格式符合预期\n4. 测试错误场景：API 超时、无效响应等\n5. 性能测试：验证响应时间 < 10秒",
        "priority": "high",
        "dependencies": [
          6,
          7
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 9,
        "title": "任务 CRUD API 与依赖关系管理",
        "description": "实现任务的增删改查接口，支持任务依赖关系的创建和查询，提供任务列表过滤和排序功能",
        "details": "1. 创建任务控制器：\n```typescript\n// server/src/controllers/taskController.ts\nexport const createTask = async (req, res) => {\n  const { title, description, priority, assignedTo, dependencies } = req.body;\n  const client = await pool.connect();\n  try {\n    await client.query('BEGIN');\n    const result = await client.query(\n      'INSERT INTO tasks (title, description, priority, assigned_to, created_by) VALUES ($1, $2, $3, $4, $5) RETURNING *',\n      [title, description, priority, assignedTo, req.user.id]\n    );\n    const taskId = result.rows[0].id;\n    if (dependencies?.length) {\n      for (const depId of dependencies) {\n        await client.query(\n          'INSERT INTO task_dependencies (task_id, depends_on_task_id) VALUES ($1, $2)',\n          [taskId, depId]\n        );\n      }\n    }\n    await client.query('COMMIT');\n    res.status(201).json(result.rows[0]);\n  } catch (e) {\n    await client.query('ROLLBACK');\n    throw e;\n  } finally {\n    client.release();\n  }\n};\n```\n2. 实现 GET /api/tasks（支持过滤：status, priority, assignedTo）\n3. 实现 GET /api/tasks/:id（包含依赖关系）\n4. 实现 PUT /api/tasks/:id 和 DELETE /api/tasks/:id\n5. 实现 GET /api/tasks/:id/dependencies（获取依赖树）\n6. 添加输入验证中间件",
        "testStrategy": "1. API 测试：使用 Jest + supertest 测试所有端点\n2. 验证事务完整性：创建任务失败时依赖关系不应插入\n3. 测试循环依赖检测：A依赖B，B依赖A应返回错误\n4. 测试过滤和排序功能\n5. 边界测试：空数据、大量依赖等",
        "priority": "high",
        "dependencies": [
          7
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 10,
        "title": "React 前端任务看板与进度可视化",
        "description": "开发任务看板界面，实现拖拽式任务状态更新、进度条显示、任务依赖关系可视化图表",
        "details": "1. 安装依赖：react-beautiful-dnd（拖拽）、recharts（图表）\n2. 创建看板组件：\n```typescript\n// client/src/components/TaskBoard.tsx\nimport { DragDropContext, Droppable, Draggable } from 'react-beautiful-dnd';\n\nconst TaskBoard = () => {\n  const [tasks, setTasks] = useState({ pending: [], inProgress: [], done: [] });\n  \n  const onDragEnd = async (result) => {\n    if (!result.destination) return;\n    const newStatus = result.destination.droppableId;\n    await axios.put(`/api/tasks/${result.draggableId}`, { status: newStatus });\n    // 更新本地状态\n  };\n  \n  return (\n    <DragDropContext onDragEnd={onDragEnd}>\n      {['pending', 'inProgress', 'done'].map(status => (\n        <Droppable droppableId={status} key={status}>\n          {/* 渲染任务卡片 */}\n        </Droppable>\n      ))}\n    </DragDropContext>\n  );\n};\n```\n3. 创建进度统计组件：\n```typescript\nconst ProgressChart = ({ tasks }) => (\n  <PieChart>\n    <Pie data={[\n      { name: '待处理', value: tasks.filter(t => t.status === 'pending').length },\n      { name: '进行中', value: tasks.filter(t => t.status === 'inProgress').length },\n      { name: '已完成', value: tasks.filter(t => t.status === 'done').length }\n    ]} />\n  </PieChart>\n);\n```\n4. 实现任务依赖关系图（使用 react-flow 或 D3.js）\n5. 添加任务筛选和搜索功能",
        "testStrategy": "1. 组件测试：使用 React Testing Library 测试渲染和交互\n2. 拖拽测试：模拟拖拽事件验证状态更新\n3. 集成测试：验证前后端数据同步\n4. 可访问性测试：键盘导航和屏幕阅读器支持\n5. 响应式测试：不同屏幕尺寸下布局正常",
        "priority": "high",
        "dependencies": [
          9
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 11,
        "title": "团队协作功能：评论、通知与实时更新",
        "description": "实现任务评论系统、用户通知机制、WebSocket 实时更新，支持多人协作编辑",
        "details": "1. 安装 socket.io：npm install socket.io socket.io-client\n2. 配置 WebSocket 服务器：\n```typescript\n// server/src/index.ts\nimport { Server } from 'socket.io';\nconst io = new Server(httpServer, { cors: { origin: '*' } });\n\nio.on('connection', (socket) => {\n  socket.on('join-task', (taskId) => socket.join(`task-${taskId}`));\n  socket.on('task-updated', (data) => {\n    io.to(`task-${data.taskId}`).emit('task-changed', data);\n  });\n});\n```\n3. 实现评论 API：\n```typescript\n// POST /api/tasks/:id/comments\nrouter.post('/:id/comments', async (req, res) => {\n  const { content } = req.body;\n  const result = await pool.query(\n    'INSERT INTO comments (task_id, user_id, content) VALUES ($1, $2, $3) RETURNING *',\n    [req.params.id, req.user.id, content]\n  );\n  io.to(`task-${req.params.id}`).emit('new-comment', result.rows[0]);\n  res.json(result.rows[0]);\n});\n```\n4. 前端集成 Socket.IO：\n```typescript\nconst socket = io('http://localhost:3001');\nuseEffect(() => {\n  socket.on('task-changed', (data) => setTasks(prev => /* 更新状态 */));\n}, []);\n```\n5. 实现通知系统：任务分配、评论提及时发送通知\n6. 添加乐观更新和冲突解决机制",
        "testStrategy": "1. WebSocket 测试：验证多客户端实时同步\n2. 评论功能测试：创建、读取、删除评论\n3. 通知测试：验证触发条件和推送逻辑\n4. 并发测试：多用户同时编辑同一任务\n5. 断线重连测试：网络中断后自动恢复",
        "priority": "medium",
        "dependencies": [
          9,
          10
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 12,
        "title": "Calculator Project",
        "description": "创建一个简单的函数式计算器，包含 add 和 multiply 函数。要求：使用 TypeScript 和 Vitest；符合函数式编程风格；代码简洁(每个函数 ≤3 行)。验收标准：所有 Vitest 测试通过；测试覆盖率 ≥90%；TypeScript 编译无错误；函数符合纯函数定义。",
        "details": "",
        "testStrategy": "",
        "status": "pending",
        "dependencies": [],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "初始化 TypeScript 配置和项目结构",
            "description": "创建 tsconfig.json 配置文件，设置 src/ 和 tests/ 目录结构，确保 TypeScript 编译环境就绪",
            "dependencies": [],
            "details": "创建 tsconfig.json（target: ES2020, module: ESNext, strict: true）；创建 src/calculator.ts 和 tests/calculator.test.ts 文件骨架；配置路径映射和输出目录",
            "status": "pending",
            "testStrategy": "运行 tsc --noEmit 验证配置无错误；检查目录结构是否符合预期"
          },
          {
            "id": 2,
            "title": "配置 Vitest 测试环境",
            "description": "创建 vitest.config.ts，配置测试覆盖率工具（c8/istanbul），设置覆盖率阈值 ≥90%",
            "dependencies": [
              1
            ],
            "details": "创建 vitest.config.ts（coverage.provider: 'v8', coverage.lines: 90, coverage.functions: 90）；在 package.json 添加测试脚本：test, test:coverage；验证 Vitest 可正常运行",
            "status": "pending",
            "testStrategy": "运行 npm test 验证测试框架启动；运行 npm run test:coverage 验证覆盖率报告生成"
          },
          {
            "id": 3,
            "title": "实现 add 函数（TDD RED 阶段）",
            "description": "先编写 add 函数的失败测试用例，覆盖正数、负数、零、浮点数等边界情况",
            "dependencies": [
              2
            ],
            "details": "在 tests/calculator.test.ts 编写测试：test('add(2, 3) returns 5'), test('add(-1, 1) returns 0'), test('add(0.1, 0.2) returns 0.3')；运行测试确认失败（RED）；实现 src/calculator.ts 中的 add 函数（≤3 行，纯函数）",
            "status": "pending",
            "testStrategy": "测试必须先失败（RED），然后实现后全部通过（GREEN）；验证函数为纯函数（无副作用）"
          },
          {
            "id": 4,
            "title": "实现 multiply 函数（TDD RED 阶段）",
            "description": "先编写 multiply 函数的失败测试用例，覆盖正数、负数、零、浮点数等边界情况",
            "dependencies": [
              3
            ],
            "details": "在 tests/calculator.test.ts 编写测试：test('multiply(2, 3) returns 6'), test('multiply(-2, 3) returns -6'), test('multiply(0, 5) returns 0')；运行测试确认失败（RED）；实现 src/calculator.ts 中的 multiply 函数（≤3 行，纯函数）",
            "status": "pending",
            "testStrategy": "测试必须先失败（RED），然后实现后全部通过（GREEN）；验证函数为纯函数（无副作用）"
          },
          {
            "id": 5,
            "title": "验收测试与质量检查",
            "description": "运行完整测试套件，验证覆盖率 ≥90%，TypeScript 编译无错误，所有函数符合纯函数定义",
            "dependencies": [
              3,
              4
            ],
            "details": "运行 npm run test:coverage 检查覆盖率报告（lines/functions/branches ≥90%）；运行 tsc --noEmit 验证无类型错误；检查 add 和 multiply 函数代码行数 ≤3 行；验证函数无副作用（无外部状态修改、无 I/O 操作）",
            "status": "pending",
            "testStrategy": "所有 Vitest 测试通过；覆盖率报告显示 ≥90%；TypeScript 编译成功；代码审查确认符合函数式编程风格"
          }
        ]
      }
    ],
    "metadata": {
      "created": "2025-11-23T02:28:39.565Z",
      "updated": "2025-11-26T06:28:45.560Z",
      "description": "Tasks for master context"
    }
  }
}